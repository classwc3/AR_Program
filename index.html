<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Î¨∏ÌôîÏû¨ Î∑∞Ïñ¥</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #000000 0%, #0a0020 50%, #050010 100%);
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò Î∞∞Í≤Ω */
        #bg-scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 255, 200, 0.03) 0px,
                    rgba(0, 255, 200, 0.03) 1px,
                    transparent 1px,
                    transparent 2px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255, 0, 255, 0.02) 0px,
                    rgba(255, 0, 255, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                );
            z-index: 0;
            pointer-events: none;
            animation: scanlineMove 8s linear infinite;
        }

        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        #video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }

        #canvas-container canvas {
            background: transparent !important;
            display: block;
        }

        /* Î°úÎî© ÌôîÎ©¥ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.98), rgba(20, 0, 30, 0.98));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(40px);
        }

        .loading-spinner {
            width: 140px;
            height: 140px;
            border: 3px solid rgba(0, 255, 200, 0.1);
            border-top-color: #00ffc8;
            border-right-color: #ff00ff;
            border-bottom-color: #00ffc8;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin-bottom: 40px;
            box-shadow: 
                0 0 60px rgba(0, 255, 200, 0.9), 
                0 0 30px rgba(255, 0, 255, 0.7),
                inset 0 0 60px rgba(0, 255, 200, 0.2);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading-text {
            color: #00ffc8;
            font-size: 18px;
            letter-spacing: 4px;
            font-weight: bold;
            text-shadow: 
                0 0 20px rgba(0, 255, 200, 0.8),
                0 0 40px rgba(255, 0, 255, 0.4);
        }

        /* ÏÉÅÎã® Ïï±Î∞î - Îçî ÎØ∏ÎûòÏ†Å */
        #top-ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: max(12px, env(safe-area-inset-top)) 16px;
            background: rgba(0,0,0,0);
            backdrop-filter: none;
            z-index: 110;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            box-shadow: none;
        }

        #logo {
            width: 100px;
            height: 100px;
            object-fit: contain;
            filter: brightness(1.3) drop-shadow(0 0 15px rgba(0, 255, 200, 0.8));
        }

        #title {
            font-size: max(22px, 3vw);
            font-weight: 1000;
            text-align: center;
            color: #00ffc8;
            letter-spacing: 4px;
            flex: 1;
            /* Îã§Ï§ë ÌÖçÏä§Ìä∏ ÏïÑÏõÉÎùºÏù∏ Ìö®Í≥º */
            text-shadow:
                0 0 20px rgba(0, 255, 200, 0.8),
                0 0 40px rgba(255, 0, 255, 0.3),
                0 0 60px rgba(0, 255, 200, 0.2),
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                0 0 4px #000;
            font-family: 'Courier New', monospace;
        }

        
        /* Ï†ïÎ≥¥ Ìå®ÎÑê */
        #info-panel {
            position: fixed;
            top: 90px;
            left: 12px;
            right: 12px;
            background: linear-gradient(135deg, rgba(0, 40, 50, 0.95), rgba(15, 0, 30, 0.9));
            backdrop-filter: blur(50px);
            border: 2px solid #00ffc8;
            border-radius: 12px;
            padding: 18px;
            z-index: 90;
            box-shadow: 
                0 0 40px rgba(0, 255, 200, 0.5),
                0 0 20px rgba(255, 0, 255, 0.3),
                inset 0 0 25px rgba(0, 255, 200, 0.08);
            max-height: 200px;
            overflow-y: auto;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-title {
            font-size: 20px;
            font-weight: 900;
            color: #00ffc8;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(0, 255, 200, 0.6);
            letter-spacing: 2px;
        }

        .info-text {
            font-size: 13px;
            color: #80ffee;
            line-height: 1.7;
            font-family: 'Courier New', monospace;
        }

        .info-text p {
            margin-bottom: 6px;
        }

        /* ÌïòÎã® UI */
        #bottom-ui {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 10px max(10px, env(safe-area-inset-bottom));
            background: rgba(0,0,0,0.00);
            backdrop-filter: none;
            z-index: 100;
            border-top: none;
            box-shadow: none;
        }

        /* Î™®Îç∏ ÏÑ†ÌÉù */
        #model-selector {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 14px;
            margin-bottom: 12px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            justify-content: flex-start;
            scroll-snap-type: x mandatory;
        }

        #model-selector::-webkit-scrollbar {
            display: none;
        }
        #model-selector > .model-card {
            scroll-snap-align: start;
        }

        .model-card {
            min-width: 120px;
            height: 140px;
            background: rgba(0, 20, 30, 0.28);
            backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.35);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: none;
            position: relative;
            overflow: hidden;
        }

        .model-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0, 255, 200, 0.15), transparent);
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .model-card:active::before {
            opacity: 1;
        }

        .model-card:active {
            border-color: #00ffc8;
            background: linear-gradient(135deg, rgba(0, 70, 90, 0.95), rgba(20, 10, 50, 0.9));
            box-shadow: 
                0 0 40px rgba(0, 255, 200, 0.7),
                0 0 20px rgba(255, 0, 255, 0.4),
                inset 0 0 20px rgba(0, 255, 200, 0.2);
            transform: scale(0.96);
        }

        .model-card.active {
            border-color: rgba(255,255,255,0.9);
            background: rgba(0, 30, 40, 0.36);
            box-shadow: none;
        }

        .model-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 8px;
            border-radius: 8px;
            object-fit: cover;
            filter: brightness(1.1) contrast(1.1);
            box-shadow: none;
        }

        .model-name {
            font-size: 13px;
            color: #00ffc8;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 255, 200, 0.5);
            font-family: 'Courier New', monospace;
        }

        /* Ïª®Ìä∏Î°§ Î≤ÑÌäº */
        #controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .control-btn {
            min-width: 64px;
            height: 64px;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(0, 255, 200, 0.12), rgba(255, 0, 255, 0.08));
            border: 2px solid #00ffc8;
            color: #00ffc8;
            font-size: 26px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                0 0 25px rgba(0, 255, 200, 0.4),
                0 0 15px rgba(255, 0, 255, 0.2),
                inset 0 0 15px rgba(0, 255, 200, 0.08);
            font-weight: 600;
        }

        .control-btn:active {
            background: linear-gradient(135deg, rgba(0, 255, 200, 0.3), rgba(255, 0, 255, 0.2));
            box-shadow: 
                0 0 50px rgba(0, 255, 200, 1),
                0 0 25px rgba(255, 0, 255, 0.6),
                inset 0 0 20px rgba(0, 255, 200, 0.25);
            transform: scale(0.92);
        }

        #capture-btn {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            background: transparent;
            border: 3px solid #ffffff;
            box-shadow: none;
            position: relative;
            font-size: 0;
        }
        #capture-btn::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ffffff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #capture-btn:active {
            transform: scale(0.88);
        }

        /* Ï†ïÎ≥¥ Î≤ÑÌäº */
        #info-button {
            position: fixed;
            right: max(12px, env(safe-area-inset-right));
            bottom: max(12px, env(safe-area-inset-bottom));
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: rgba(0,0,0,0.25);
            border: 2px solid #00ffc8;
            color: #00ffc8;
            font-weight: 800;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 16px rgba(0,255,200,0.4);
            z-index: 120;
        }
        #info-button:active {
            transform: scale(0.92);
        }

        /* ÌÜ†Ïä§Ìä∏ */
        #toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 255, 200, 0.95), rgba(0, 200, 180, 0.95));
            color: #000;
            padding: 22px 50px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 10000;
            display: none;
            box-shadow: 
                0 0 60px rgba(0, 255, 200, 1),
                0 0 30px rgba(255, 0, 255, 0.6);
            border: 2px solid rgba(0, 50, 50, 0.3);
            font-weight: 700;
            letter-spacing: 2px;
            animation: toastAppear 0.3s ease-out;
            font-family: 'Courier New', monospace;
        }

        @keyframes toastAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.85);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Î™®Î∞îÏùº Í∞ÄÎ°ú(landscape) ÏµúÏ†ÅÌôî */
        @media (orientation: landscape) and (max-width: 1024px) {
            #top-ui {
                padding: 8px 12px;
                border-bottom-width: 2px;
            }
            #title {
                font-size: 14px;
                letter-spacing: 2px;
            }
            #logo {
                width: 46px;
                height: 46px;
            }
            #bottom-ui {
                padding: 6px 8px max(6px, env(safe-area-inset-bottom));
            }
            #model-selector {
                gap: 8px;
                padding-bottom: 8px;
                margin-bottom: 6px;
            }
            .model-card {
                min-width: 88px;
                height: 100px;
                padding: 8px;
            }
            .model-icon {
                width: 52px;
                height: 52px;
                margin-bottom: 6px;
            }
            .model-name {
                font-size: 11px;
            }
            #controls {
                position: fixed;
                right: 12px;
                bottom: max(12px, env(safe-area-inset-bottom));
                gap: 8px;
            }
            .control-btn {
                min-width: 52px;
                height: 52px;
                font-size: 20px;
            }
            #capture-btn {
                width: 68px;
                height: 68px;
                position: fixed;
                right: max(12px, env(safe-area-inset-right));
                top: 50%;
                transform: translateY(-50%);
                z-index: 110;
            }
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            #title {
                font-size: 16px;
                letter-spacing: 3px;
            }

            #logo {
                width: 42px;
                height: 42px;
            }

            .model-card {
                min-width: 100px;
                height: 120px;
            }

            .model-icon {
                width: 55px;
                height: 55px;
                margin-bottom: 6px;
            }

            .model-name {
                font-size: 12px;
            }

            #info-panel {
                font-size: 12px;
                padding: 15px;
                top: 80px;
            }

            .control-btn {
                min-width: 58px;
                height: 58px;
                font-size: 22px;
            }

            #capture-btn {
                width: 72px;
                height: 72px;
                font-size: 0;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="bg-scanlines"></div>
        <video id="video-background" autoplay playsinline muted></video>
        <audio id="bg-music" autoplay loop muted>
            <source src="models/bg.mp3" type="audio/mpeg">
        </audio>
        <div id="canvas-container"></div>

        <div id="loading-screen">
            <div class="loading-spinner"></div>
            <div id="loading-text">Î°úÎî©Ï§ë...</div>
        </div>

        <div id="top-ui">
            <img id="logo" src="logos/logo.png" alt="Logo" onerror="this.style.display='none'">
            <div id="title">SKY TEAM - AR Ï≤¥Ìóò</div>
        </div>

        <div id="info-panel">
            <div class="info-title" id="info-title">Î¨∏ÌôîÏû¨</div>
            <div class="info-text" id="info-description"></div>
        </div>

        <div id="bottom-ui">
            <div id="model-selector"></div>
            <div id="controls"></div>
        </div>

        <div id="toast"></div>
        <button id="info-button" title="Ï†ïÎ≥¥">i</button>
    </div>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.170.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.170.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import { TGALoader } from 'three/addons/loaders/TGALoader.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

        const culturalAssets = [
            {
                id: 'logo',
                name: 'SKY TEAM',
                file: 'models/Î°úÍ≥†.fbx',
                type: 'fbx',
                thumbnail: 'logos/logo.png',
                description: 'Ïö∞Î¶¨ SKY Robot Development TeamÏùò Î°úÍ≥†ÏûÖÎãàÎã§.',
                info: 'ÌôîÏù¥ÌåÖ!!!!!!!!'
            },
            {
                id: 'geonsukmun',
                name: 'Í±¥ÏàôÎ¨∏',
                file: 'models/Í±¥ÏàôÎ¨∏.fbx',
                type: 'fbx',
                thumbnail: 'logos/Í±¥ÏàôÎ¨∏.png',
                description: 'Í≤ΩÎ≥µÍ∂ÅÏùò ÌÉúÏõêÏ†Ñ Íµ¨Ïó≠Ïóê ÏûàÎäî Î¨∏ÏúºÎ°ú, "ÏóÑÏàôÌï®ÏùÑ ÏÑ∏Ïö¥Îã§"Îäî ÎúªÏùÑ Îã¥Í≥† ÏûàÏäµÎãàÎã§.',
                info: '1872ÎÖÑ(Í≥†Ï¢Ö 9ÎÖÑ)'
            },
            {
                id: 'junghwamoon',
                name: 'Ï§ëÌôîÎ¨∏',
                file: 'models/Ï§ëÌôîÎ¨∏.fbx',
                type: 'fbx',
                thumbnail: 'logos/Ï§ëÌôîÎ¨∏.png',
                description: 'ÎåÄÌïúÏ†úÍµ≠Ïùò Ìô©Ï†úÍ∞Ä ÌïòÎ°ÄÎ•º Î∞õÍ±∞ÎÇò Íµ≠Í∞Ä ÌñâÏÇ¨Î•º Í±∞ÌñâÌïòÎçò Ï†ïÏ†Ñ(Ê≠£ÊÆø)Í≥º Í∑∏ Ï†ïÎ¨∏ÏûÖÎãàÎã§.',
                info: '1902ÎÖÑ'
            },
            {
                id: 'changsinmun',
                name: 'Ï∞ΩÏã†Î¨∏',
                file: 'models/Ï∞ΩÏã†Î¨∏.fbx',
                type: 'fbx',
                thumbnail: 'logos/Ï∞ΩÏã†Î¨∏.png',
                description: 'ÎçïÏàòÍ∂ÅÏùò ÏÑúÏ™ΩÏóê ÏûàÎäî Î¨∏ÏúºÎ°ú, Ï†ïÍ¥ÄÌóå ÏÑúÏ™ΩÍ≥º ÏÑùÏñ¥Îãπ ÏÇ¨Ïù¥Ïóê ÏûàÏäµÎãàÎã§. "Ï∞ΩÏã†(ÂΩ∞‰ø°)"ÏùÄ "Ïã†Î¢∞Î•º Î∞ùÌûåÎã§"Îäî ÏùòÎØ∏Î•º Îã¥Í≥† ÏûàÏäµÎãàÎã§. .',
                info: '1897ÎÖÑ'
            },
            {
                id: 'sajeongmun',
                name: 'ÏÇ¨Ï†ïÎ¨∏',
                file: 'models/ÏÇ¨Ï†ïÎ¨∏.fbx',
                type: 'fbx',
                thumbnail: 'logos/ÏÇ¨Ï†ïÎ¨∏.png',
                description: 'ÏôïÏù¥ ÌèâÏÜå Íµ≠Ï†ïÏùÑ ÏÇ¥ÌîºÎçò ÏÇ¨Ï†ïÏ†Ñ ÏïûÏùÑ Ïó∞Í≤∞ÌïòÎäî Í±¥Ï∂ïÎ¨ºÏûÖÎãàÎã§.',
                info: '1867ÎÖÑ(Í≥†Ï¢Ö 4ÎÖÑ)'
            }
        ];

        let scene, camera, renderer, controls;
        let currentModel = null;
        let mixer = null;
        let clock = new THREE.Clock();
        let lights = {};
        let cameraActive = false;
        let videoStream = null;
        let infoHideTimeout = null;

        const loadingScreen = document.getElementById('loading-screen');
        const loadingText = document.getElementById('loading-text');
        const infoPanel = document.getElementById('info-panel');
        const modelSelector = document.getElementById('model-selector');
        const canvasContainer = document.getElementById('canvas-container');
        const videoBackground = document.getElementById('video-background');
        // Ïπ¥Î©îÎùº ÌÜ†Í∏Ä Ï†úÍ±∞Îê®
        const bgMusic = document.getElementById('bg-music');

        // Î∞∞Í≤ΩÏùåÏïÖ ÏûêÎèô Ïû¨ÏÉù ÏãúÎèÑ
        function autoPlayMusic() {
            bgMusic.play().catch(() => {});

            document.addEventListener('click', () => {
                bgMusic.muted = false;
                bgMusic.play().catch(() => {});
            }, { once: true });
        }


        function lockPortraitMode() {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('portrait').catch(() => {});
            }
        }

        function init() {
            lockPortraitMode();

            scene = new THREE.Scene();
            scene.background = null;

            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 1.5, 4);

            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true,
                preserveDrawingBuffer: true,
                powerPreference: 'high-performance'
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.8;
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            canvasContainer.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.06;
            controls.minDistance = 1;
            controls.maxDistance = 12;
            controls.maxPolarAngle = Math.PI / 1.8;
            controls.touches = {
                ONE: THREE.TOUCH.ROTATE,
                TWO: THREE.TOUCH.DOLLY_PAN
            };

            lights.ambient = new THREE.AmbientLight(0xffffff, 3.0);
            scene.add(lights.ambient);

            lights.hemisphere = new THREE.HemisphereLight(0xffffff, 0x80ffd9, 2.5);
            lights.hemisphere.position.set(0, 20, 0);
            scene.add(lights.hemisphere);

            lights.directional1 = new THREE.DirectionalLight(0xffffff, 4.0);
            lights.directional1.position.set(8, 15, 8);
            lights.directional1.castShadow = true;
            lights.directional1.shadow.camera.top = 20;
            lights.directional1.shadow.camera.bottom = -20;
            lights.directional1.shadow.camera.left = -20;
            lights.directional1.shadow.camera.right = 20;
            lights.directional1.shadow.mapSize.width = 2048;
            lights.directional1.shadow.mapSize.height = 2048;
            scene.add(lights.directional1);

            lights.directional2 = new THREE.DirectionalLight(0xffffff, 3.0);
            lights.directional2.position.set(-10, 12, -10);
            scene.add(lights.directional2);

            lights.directional3 = new THREE.DirectionalLight(0x00ffc8, 2.0);
            lights.directional3.position.set(15, 8, 0);
            scene.add(lights.directional3);

            lights.point = new THREE.PointLight(0x00ffc8, 3.0, 60);
            lights.point.position.set(0, 5, 0);
            scene.add(lights.point);

            const floorGeometry = new THREE.PlaneGeometry(40, 40);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x000000,
                transparent: true,
                opacity: 0
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = 0;
            floor.receiveShadow = true;
            scene.add(floor);

            THREE.DefaultLoadingManager.addHandler(/\.tga$/i, new TGALoader());

            createModelSelector();
            setupEventListeners();
            loadModel(culturalAssets[0]);

            animate();

            loadingText.textContent = 'Ïπ¥Î©îÎùº Í∂åÌïú...';
            setTimeout(() => initCamera(), 800);
        }

        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    }
                });

                videoStream = stream;
                videoBackground.srcObject = stream;
                cameraActive = true;
                videoBackground.style.display = 'block';
                // showToast('AR Î™®Îìú ÌôúÏÑ±Ìôî');

                // Ï≤´ ÌÑ∞ÏπòÏóê ÏùåÏïÖ Ïû¨ÏÉù
                autoPlayMusic();
            } catch (error) {
                console.log('Ïπ¥Î©îÎùº Î∂àÍ∞Ä:', error);
                videoBackground.style.display = 'none';
                // showToast('ÏùºÎ∞ò Î™®Îìú');
                autoPlayMusic();
            }
        }

        function toggleCamera() {
            if (cameraActive && videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoBackground.style.display = 'none';
                cameraActive = false;
                // showToast('ÏùºÎ∞ò Î™®Îìú');
            } else {
                initCamera();
            }
        }

        function createModelSelector() {
            culturalAssets.forEach((asset, index) => {
                const card = document.createElement('div');
                card.className = 'model-card';
                card.dataset.id = asset.id;
                if (index === 0) card.classList.add('active');

                const thumbImg = document.createElement('img');
                thumbImg.className = 'model-icon';
                thumbImg.src = asset.thumbnail;
                thumbImg.alt = asset.name;
                thumbImg.onerror = () => {
                    thumbImg.textContent = 'üì∑';
                };

                const nameDiv = document.createElement('div');
                nameDiv.className = 'model-name';
                nameDiv.textContent = asset.name;

                card.appendChild(thumbImg);
                card.appendChild(nameDiv);

                card.addEventListener('click', () => {
                    document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    loadModel(asset);
                });

                modelSelector.appendChild(card);
            });
        }

        function loadModel(asset) {
            loadingScreen.style.display = 'flex';
            loadingText.textContent = `${asset.name} Î°úÎî©...`;

            if (currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }
            if (mixer) mixer = null;

            infoPanel.style.display = 'block';
            document.getElementById('info-title').textContent = asset.name;
            document.getElementById('info-description').innerHTML = `
                <p>${asset.description}</p>
                <p style="margin-top: 6px; opacity: 0.8;">${asset.info}</p>
            `;

            if (infoHideTimeout) clearTimeout(infoHideTimeout);
            infoHideTimeout = setTimeout(() => { infoPanel.style.display = 'none'; }, 5000);

            if (asset.type === 'fbx') {
                const fbxLoader = new FBXLoader();
                fbxLoader.load(
                    asset.file,
                    (fbx) => setupModel(fbx, asset),
                    (xhr) => {
                        if (xhr.total > 0) {
                            const percent = Math.round(xhr.loaded / xhr.total * 100);
                            loadingText.textContent = `${asset.name} ${percent}%`;
                        }
                    },
                    () => {
                        loadingScreen.style.display = 'none';
                        showToast('Î°úÎî© Ïã§Ìå®');
                    }
                );
            } else if (asset.type === 'obj') {
                const objLoader = new OBJLoader();
                const manager = new THREE.LoadingManager();

                manager.onProgress = (url, loaded, total) => {
                    if (total > 0) {
                        const percent = Math.round(loaded / total * 100);
                        loadingText.textContent = `${asset.name} ${percent}%`;
                    }
                };

                manager.onError = () => {
                    loadingScreen.style.display = 'none';
                    showToast('ÌååÏùº Ïò§Î•ò');
                };

                objLoader.manager = manager;
                objLoader.load(
                    asset.file,
                    (obj) => setupModel(obj, asset),
                    undefined,
                    () => {
                        loadingScreen.style.display = 'none';
                        showToast('Î°úÎî© Ïã§Ìå®');
                    }
                );
            } else if (asset.type === 'gltf') {
                    const gltfLoader = new GLTFLoader();

                    const dracoLoader = new DRACOLoader();
                    dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
                    gltfLoader.setDRACOLoader(dracoLoader);

                    gltfLoader.load(
                        asset.file,
                        (gltf) => setupModel(gltf.scene, asset),
                        (xhr) => {
                            if (xhr.total > 0) {
                                const percent = Math.round(xhr.loaded / xhr.total * 100);
                                loadingText.textContent = `${asset.name} ${percent}%`;
                            }
                        },
                        () => {
                            loadingScreen.style.display = 'none';
                            showToast('Î°úÎî© Ïã§Ìå®');
                        }
                    );
                }

        }

        function setupModel(model, asset) {
            currentModel = model;

            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 2.5 / maxDim;
            model.scale.setScalar(scale);

            box.setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            model.position.x = -center.x * scale;
            model.position.y = -box.min.y * scale;
            model.position.z = -center.z * scale;

            model.traverse((child) => {
                if (child.isMesh) {
                    if (child.material) {
                        child.material.emissive = new THREE.Color(0x000000);
                        if (child.material.map) {
                            child.material.map.colorSpace = THREE.SRGBColorSpace;
                        }
                    }
                    child.castShadow = true;
                    child.receiveShadow = true;
                }
            });

            if (model.animations && model.animations.length > 0) {
                mixer = new THREE.AnimationMixer(model);
                const action = mixer.clipAction(model.animations[0]);
                action.play();
            }

            scene.add(model);
            loadingScreen.style.display = 'none';
            showToast(`${asset.name} Ï§ÄÎπÑ ÏôÑÎ£å`);
        }

        function setupEventListeners() {
            const infoBtn = document.getElementById('info-button');
            infoBtn.addEventListener('click', toggleInfoPanel);

            const buttonsData = [
                // { id: 'reset-btn', label: '‚ü≤', action: () => {
                //     controls.reset();
                //     camera.position.set(0, 1.5, 4);
                //     showToast('Ï¥àÍ∏∞Ìôî');
                // }},
                { id: 'capture-btn', label: '', action: captureScreen }
                // { id: 'light-btn', label: 'üí°', action: () => {
                //     const isVisible = !lights.directional1.visible;
                //     Object.values(lights).forEach(light => { if (light) light.visible = isVisible; });
                //     showToast(isVisible ? 'Ï°∞Î™Ö ÏºúÏßê' : 'Ï°∞Î™Ö Í∫ºÏßê');
                // }}
            ];

            const controlsDiv = document.getElementById('controls');
            buttonsData.forEach(btn => {
                const button = document.createElement('button');
                button.id = btn.id;
                button.className = 'control-btn';
                button.textContent = btn.label;
                button.addEventListener('click', btn.action);
                controlsDiv.appendChild(button);
            });

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        function toggleInfoPanel() {
            if (infoPanel.style.display === 'none' || infoPanel.style.display === '') {
                infoPanel.style.display = 'block';
                if (infoHideTimeout) clearTimeout(infoHideTimeout);
                infoHideTimeout = setTimeout(() => { infoPanel.style.display = 'none'; }, 5000);
            } else {
                infoPanel.style.display = 'none';
                if (infoHideTimeout) clearTimeout(infoHideTimeout);
            }
        }

        function captureScreen() {
            try {
                const dpr = window.devicePixelRatio || 1;
                const width = window.innerWidth * dpr;
                const height = window.innerHeight * dpr;

                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.scale(dpr, dpr);

                // Î∞∞Í≤Ω Í∑∏Î¶¨Í∏∞
                if (cameraActive && videoBackground.videoWidth > 0) {
                    const videoRatio = videoBackground.videoWidth / videoBackground.videoHeight;
                    const screenRatio = window.innerWidth / window.innerHeight;
                    
                    let sx, sy, sw, sh;
                    if (videoRatio > screenRatio) {
                        sw = videoBackground.videoHeight * screenRatio;
                        sh = videoBackground.videoHeight;
                        sx = (videoBackground.videoWidth - sw) / 2;
                        sy = 0;
                    } else {
                        sw = videoBackground.videoWidth;
                        sh = videoBackground.videoWidth / screenRatio;
                        sx = 0;
                        sy = (videoBackground.videoHeight - sh) / 2;
                    }
                    
                    ctx.drawImage(videoBackground, sx, sy, sw, sh, 0, 0, window.innerWidth, window.innerHeight);
                } else {
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
                }

                // 3D Î†åÎçî Ïò§Î≤ÑÎ†àÏù¥
                renderer.render(scene, camera);
                ctx.drawImage(renderer.domElement, 0, 0, window.innerWidth, window.innerHeight);

                // ÏõåÌÑ∞ÎßàÌÅ¨ ÌÖçÏä§Ìä∏
                ctx.fillStyle = 'rgba(0, 255, 200, 0.6)';
                ctx.font = 'bold 16px "Courier New"';
                ctx.fillText('SKY-TEAM(Ï°∞ÏÑ±Ïö∞)', 20, window.innerHeight - 20);

                // Ïö∞ÌïòÎã® Î°úÍ≥† ÏõåÌÑ∞ÎßàÌÅ¨
                try {
                    const wmImg = new Image();
                    wmImg.crossOrigin = 'anonymous';
                    wmImg.onload = () => {
                        const logoW = 150; // Î°úÍ≥† ÏõåÌÑ∞ÎßàÌÅ¨ ÎÑàÎπÑ
                        const logoH = 100; // Î°úÍ≥† ÏõåÌÑ∞ÎßàÌÅ¨ ÎÜíÏù¥
                        const pad = 16;   // Ïó¨Î∞±
                        const x = window.innerWidth - logoW - pad;
                        const y = window.innerHeight - logoH - pad;
                        ctx.globalAlpha = 0.9;
                        ctx.drawImage(wmImg, x, y, logoW, logoH);
                        ctx.globalAlpha = 1.0;

                        const dataURL = canvas.toDataURL('image/png', 0.95);
                        const link = document.createElement('a');
                        link.download = `SKY-TEAM(Ï°∞ÏÑ±Ïö∞)_ARÎ¨∏ÌôîÏû¨_${Date.now()}.png`;
                        link.href = dataURL;
                        link.click();
                    };
                    wmImg.src = 'logos/logo.png';
                } catch (e) {
                    const dataURL = canvas.toDataURL('image/png', 0.95);
                    const link = document.createElement('a');
                    link.download = `SKY-TEAM(Ï°∞ÏÑ±Ïö∞)_ARÎ¨∏ÌôîÏû¨_${Date.now()}.png`;
                    link.href = dataURL;
                    link.click();
                }
                
                showToast('ÏÇ¨ÏßÑ Ï†ÄÏû• ÏôÑÎ£å');
            } catch (error) {
                console.error('Ï∫°Ï≤ò Ïò§Î•ò:', error);
                showToast('Ï∫°Ï≤ò Ïã§Ìå®');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 2500);
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            if (mixer) mixer.update(delta);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
